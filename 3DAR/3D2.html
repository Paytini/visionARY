<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
        async function fetchAndApplyMarker() {
            try {
                const response = await fetch('https://localhost:4000/');
                console.log("feched 1");
                const response2 = await fetch('https://localhost:4000/model');
                console.log("feched 2");
        
                if (!response.ok) {
                    throw new Error('Failed to fetch pattern data');
                }
                if (!response2.ok) {
                    throw new Error('Failed to fetch model data');
                }
        
                const patternData = await response.arrayBuffer();
                const modelData = await response2.arrayBuffer();
        
                const patternUrl = URL.createObjectURL(new Blob([patternData]));
                const marker = document.querySelector('a-marker');
                marker.setAttribute('pattern', { type: 'barcode', url: patternUrl });
                
                const model = document.querySelector('a-entity');
                model.setAttribute('gltf-model', URL.createObjectURL(new Blob([modelData])));

                // 重启相机
                startCamera();
            } catch (error) {
                console.error('Error fetching marker data:', error);
            }
        }
        function startCamera() {
            const scene = document.querySelector('a-scene');
            scene.camera.active = true;
        }

        fetchAndApplyMarker();
    </script>
</head>
<body style="margin : 0px; overflow: hidden;">
    <a-scene embedded arjs>
        <a-marker type="barcode">
            <a-entity
                position="0 0 0"
                scale="0.02 0.02 0.02"
                rotation="0 0 0"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 10000" 
            ></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
